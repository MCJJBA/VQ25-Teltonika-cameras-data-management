# Camera Upload System

This repository contains a system for handling camera uploads, storing media files, and processing metadata. It leverages Docker, Kafka, and a MySQL database.

---

## Table of Contents

- [Prerequisites](#prerequisites)  
- [Setup](#setup)  
  - [1. Create Docker Container](#1-create-docker-container)  
  - [2. Create Kafka Topic](#2-create-kafka-topic)  
  - [3. Check Kafka Topics](#3-check-kafka-topics)  
- [Running the Application](#running-the-application)  
- [Uploads Directory](#uploads-directory)  
- [Database Configuration](#database-configuration)  
- [Database Schema](#database-schema)  
  - [Tables Description](#tables-description)  
  - [Relationships Summary](#relationships-summary)  
  - [Design Notes](#design-notes)  

---

## Prerequisites

- Docker and Docker Compose installed  
- Node.js installed  
- MySQL server (or Docker MySQL container)  
- Browser to open the `index.html`  

---

## Setup

### 1. Create Docker Container

Run the following command in the project root:

```bash
docker compose up
```

### 2. Create the camera-events Topic in Kafka

```bash
docker exec -it kafka1 kafka-topics.sh --create --topic camera-events --partitions 1 --replication-factor 1 --bootstrap-server localhost:9095

```
### 3. Check Kafka Topics

```bash
docker exec -it kafka1 kafka-topics.sh --list --bootstrap-server localhost:9095

```



## Running the Application

### 1. Start the necessary Node.js scripts in order:

```bash
node avlServer.js
node serverConsumer.js
node index.js

```
### 2. Open index.html in your browser.

### 3. Send the image or video, along with the IMEI packet and the AVL packet.


## Uploads Directory

Create a directory for uploaded files:

```bash
C:\uploads

```
Or change the path in the code to your preferred directory.

## Database Configuration
Update dbConfig.js if you need to change the database name:

```javascript
// dbConfig.js example
const dbConfig = {
  host: "localhost",
  user: "root",
  password: "password",
  database: "cameras_db"
};

```

# Database Schema
## Tables Description
### 1. Clients

Stores information about end clients using the system. Each client is uniquely identified by a client_id (IMEI).

| Column       | Type         | Key | Description                     |
| ------------ | :----------- | :-: | ------------------------------- |
| client_id    | BIGINT       |  PK | Unique client identifier (IMEI) |
| client_email | VARCHAR(100) |     | Email address of the client     |

#### Purpose:

* Represents customers or devices registered in the system.

* Acts as a reference for camera uploads via IMEI.

### 2. Admin

Stores administrator credentials for managing the system.

| Column      | Type         | Key | Description                        |
| ----------- | :----------- | :-: | ---------------------------------- |
| admin_id    | INT          |  PK | Unique administrator identifier    |
| admin_email | VARCHAR(255) |     | Administrator email                |
| password    | VARCHAR(100) |     | Hashed password for authentication |


#### Purpose:

* Manages access control and administrative operations.


###  3. CameraFiles

Stores metadata generated by cameras at the time of upload.

| Column     | Type         | Key | Description                         |
| ---------- | :----------- | :-: | ----------------------------------- |
| id         | INT          |  PK | Unique record identifier            |
| camera_id  | INT          |     | Identifier of the camera device     |
| timestamp  | DATETIME     |     | Capture date and time               |
| lat        | DOUBLE       |     | Latitude coordinate                 |
| lon        | DOUBLE       |     | Longitude coordinate                |
| speed      | INT          |     | Camera speed at capture             |
| altitude   | INT          |     | Altitude at capture                 |
| angle      | INT          |     | Camera angle                        |
| satellites | INT          |     | Number of GPS satellites detected   |
| upload_ref | BIGINT       |     | Reference ID linking to media files |
| file_path  | VARCHAR(255) |     | Path to stored camera file          |
| imei       | VARCHAR(15)  |     | Camera IMEI (links to Clients)      |

#### Purpose:
* Stores technical and geolocation metadata.

* Links clients to uploaded media.

###  4. Media

Stores media files associated with a specific upload reference.

| Column     | Type         | Key | Description                      |
| ---------- | :----------- | :-: | -------------------------------- |
| id         | INT          |  PK | Unique media identifier          |
| upload_ref | BIGINT       |     | Reference linking to CameraFiles |
| name       | VARCHAR(255) |     | Media file name                  |
| file_path  | VARCHAR(512) |     | Path to media file               |

#### Purpose:

* Allows multiple media files per camera upload.

* Separates media storage from metadata for scalability

###  Relationships Summary

* Clients ↔ CameraFiles: Linked via imei. One client can have multiple camera file records.

* CameraFiles ↔ Media: Linked via upload_ref. One camera upload can have multiple media files.

### Design Notes

* Metadata (CameraFiles) is separated from media (Media) for performance.

* upload_ref allows grouping multiple files under a single capture event.

* IMEI-based identification enables direct association between devices and clients.





















